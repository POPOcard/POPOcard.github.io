
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>订单查询</title>
        <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
        <link rel="stylesheet" href="https://static.91haoka.cn/vant.css"/>
        <script src="https://static.91haoka.cn/vue.min.js"></script>
        <script src="https://static.91haoka.cn/vantall.js"></script>
        <script src="https://static.91haoka.cn/axios.min.js"></script>
		<link rel="stylesheet" type="text/css" href="https://static.91haoka.cn/all.css"/>
     </head>
    <style type="text/css">
		*{ box-sizing: border-box; font-family:'PingFang SC'; font-size: 14px;}
		.p1{ background: #E7EEFF; border-radius: 0.4rem; padding: 0.3rem;}
		.p1 img{ width: 0.54rem;}
		.t1{ margin-top: 0.2rem; font-size: 0.28rem; color: #2D3038;}
		.btnx{ background: #FF3400; border-radius: 0.6rem; color: #fff; font-weight: bold; margin-top: 0.15rem; width: 1.7rem; padding: 0.2rem 0rem; text-align: center;}
		.p2 img{ width: 0.34rem;}
		.t2{ font-size: 0.22rem; margin-top: 0.05rem;}
		.li{ padding: 0.3rem 0; background: #fff; padding:0.2rem 0.4rem; margin-bottom: 0.2rem;}
		.act{ color: #FF3400;}
		
		.van-popup{ background: transparent;}
		.van-loading__text{ color: #FFFFFF;}
		
		.k1 {
			margin-bottom: 0.3rem;
		}
				
		.k3 {
			color: #FF6367;
			margin-bottom: 0.2rem;
		}
				
		.k2 {
			
		}
				
		.van-field {
			background: #FFFFFF;
		}
				
		.red {
			color: #FF6367;
			font-size: 0.28rem;
			margin: 0 0.05rem;
		}
				
		.inp {
			position: relative;
			margin-bottom: 0.3rem;
		}
				
		.inpa {
			position: absolute;
			right: 0.1rem;
			top: 7px;
			color: #FFFFFF;
			background: #FFB300;
			padding: 0 0.2rem;
		}
		.btn{
			background: #FFB300; color: #FFFFFF;
			padding: 0.2rem 0.6rem; border-radius: 3px; text-align: center; font-weight: bold; font-size: 0.3rem;
		}
		.btn2{
			background: #FFB300; color: #FFFFFF; width: 2rem;
			padding: 0.1rem 0.3rem; border-radius: 3px; text-align: center; font-weight: bold; font-size: 0.25rem;
		}
    </style>
	<body>
        <div id="app" style="background: #F1F1F1; min-height: 100vh;" v-cloak>
			<div v-if="!jieguo" class="k2 btn" style="position: fixed; right: 0rem; bottom: 0rem; z-index: 99; width: 100%; font-size: 14px; padding:0.2rem 0.2rem;" @click="jieguo = !jieguo">更换查询手机号</div>
			<div class="list" style="padding-bottom: 1rem;">
				<div style="padding: 0.4rem;" v-if="jieguo">
						
					<div class="inp">
						<van-field v-model="all.mobile" placeholder="请输入收货电话" />
					</div>
					<div class="inp">
						<van-field v-model="all.id_card_num" placeholder="请输入购卡者身份证号" />
					</div>
					<div class="inp">
						<van-field v-model="all.code" placeholder="请输入验证码" ></van-field>
						<van-button class="inpa" size="small" @click="getcode" :disabled="use">{{countname}}</van-button>
					</div>
					<div class="k2 btn" @click="chaxun">查询订单</div>
				</div>
				
				<div v-if="!jieguo && list == ''" style="width: 100vw; height: 100vh;" class="flexcc" style="color: #666666; font-size: 0.35rem;">
					本手机号下面没有订单
				</div>
				<div class="li" v-for="item in list" :key='item.id'>
					<div style="margin-left: 0.2rem; font-weight: bold; line-height: 0.5rem; ">
						
						<div style="color: #666;">{{item.product_sku}}</div>
						<div style="color: #666;">订单号：{{item.id}}</div>
						<div style="color: #f00;">订单状态：{{item.status}}</div>
						<div style="color: #666;">收件人：{{item.address_name}}</div>
						<div style="color: #666;">物流公司：{{item.company}}</div>
						<div style="color: #666;">物流单号：{{item.tracking_number}}</div>
					
					</div>
					
				</div>
				
			</div>
			<!-- <div class="fixed" style="bottom: 0; background: #fff; ">
				<div class="flexb" style=" padding: 0.15rem 0rem; text-align: center;">
					<div style="flex: 1;" @click="go('index.html?shop=127837')">
						<div class="p2 flexcc"><img src="img/i44.png"></div>
						<div class="t2 ">主页</div>
					</div>
					<div style="flex: 1;" @click="go('kefu.html')">
						<div class="p2 flexcc"><img src="img/i5.png"></div>
						<div class="t2 ">在线客服</div>
					</div>
					<div style="flex: 1;" @click="go2">
						<div class="p2 flexcc"><img src="img/i66.png"></div>
						<div class="t2 act">订单查询</div>
					</div>
				</div>
			</div> -->
        </div>

       
        <script>
            var h = document.documentElement.clientWidth / 7.5 + 'px';
                document.documentElement.style.fontSize = h;

            
            new Vue({
                el: '#app',
                data: function() {
                	return {
                       all: {
                       	mobile:"",
                       	id_card_num:"",
						code:""
                       },
                       countname:"获取验证码",
                       count:30,
                       use:false,
                       person:"",
                       ing:false,
					   list:"",
					   jieguo:true
                	}
                },
                created(){
                   if(localStorage.getItem('mobile')&&localStorage.getItem('id_card_num')){
					this.all.mobile = localStorage.getItem('mobile')
					this.all.id_card_num = localStorage.getItem('id_card_num')
                   	this.jieguo = false
					
                   // 	axios.get(`/web/page/query/order/code?mobile=${localStorage.getItem('mobile')}&id_card_num=${localStorage.getItem('id_card_num')}&code=${this.all.code}`)
                   // 		.then(response => {
                   // 			if(response.data.msg.code == 0){
                   // 				let list = response.data.data
                   // 				let list2 = []
                   // 				let ids = []
                   // 				list.forEach(item=>{
                   // 					console.log(ids.includes(item.id))
                   // 					if(!ids.includes(item.id)){
                   // 						ids.push(item.id)
                   // 						list2.push(item)
                   // 					}else{
                   						
                   // 					}
                   // 				})
                   // 				this.list = list2
                   // 			}else{
                   // 				vant.Toast(response.data.msg.info);
                   // 			}
                   // 		})
                   }else{
                   	
                   }
                },
                mounted () {
                   
                },
                methods:{
					tuikuan:function(id){
						axios.post(`/api/plan-market/address/mobile/refund`,{id:id})
							.then(response => {
								if(response.data.msg.code == 0){
									vant.Toast('已发起退款申请');
									this.chaxun()
								}else{
									vant.Toast(response.data.msg.info);
								}
							})
					},
					chaxun:function(){
						
						if(this.all.mobile.length != 11 || this.all.id_card_num.length != 18){
							vant.Toast('请输入正确的手机号和身份证号');
							return false
						}
						if(this.all.code == ''){
							vant.Toast('请输入验证码');
							return false
						}
						
						axios.get(`/web/page/queryorders`,{params:this.all})
							.then(response => {
								if(response.data.msg.code == 0){
									localStorage.setItem('mobile',this.all.mobile)
									localStorage.setItem('id_card_num',this.all.id_card_num)
									this.jieguo = false
									let list = response.data.data
									let list2 = []
									let ids = []
									list.forEach(item=>{
										console.log(ids.includes(item.id))
										if(!ids.includes(item.id)){
											ids.push(item.id)
											list2.push(item)
										}else{
											
										}
									})
									this.list = list2
								}else{
									vant.Toast(response.data.msg.info);
								}
							})
					},
					daojishi:function(){
						if(this.all.phone == ''){
							return false
						}
						this.use = true
						this.dao = setInterval(()=>{
							if(this.count > 0){
								this.count --
								this.countname = this.count + '秒后重新获取'
							}else{
								this.count = 30
								this.countname = '获取验证码'
								clearInterval(this.dao)
								this.use = false
							}
						},1000)
					},
					getcode:function(){
						axios.get(`/web/page/query/order/code?mobile=${this.all.mobile}`)
							.then(response => {
								if(response.data.msg.code == 0){
									this.$toast('验证码已发送');
									this.daojishi()
								}else{
									vant.Toast(response.data.msg.info);
								}
							})
					},
					
                    go:function(url){
                    	window.location.href = url
                    },
					go2:function(){
						window.location.href = 'chadan.html'
					},
					go3:function(){
						window.location.href = 'https://work.weixin.qq.com/kfid/kfc3e3ac50ca14e6ef8'
					}
                }
            });

  
        </script>
	</body>
</html>
